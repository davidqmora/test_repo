@page "/"
@using WebUI.Services

<AuthorizeView>
    <Authorized>
        <MudButton Variant="Variant.Outlined"
                   OnClick="@GetPhotos">
            Get Photos
        </MudButton>
        <MudPaper MaxHeight="300px"
                  Class="overflow-scroll">
            @foreach (var message in Messages)
            {
                <MudText>@message</MudText>
            }
        </MudPaper>
    </Authorized>
    <NotAuthorized>
        <MudMainContent>
            <MudCard>
                <MudCardContent>
                    <MudText>
                        Authorized access required
                    </MudText>
                    <MudText>
                        This application requires authorized access. If you feel you should be able to see the content, 
                        please reach out to Cloud Services Team (Slack: #cloud-services) for assistance.
                    </MudText>
                </MudCardContent>
            </MudCard>
        </MudMainContent>
    </NotAuthorized>
</AuthorizeView>


@using Microsoft.Identity.Web
@inject MicrosoftIdentityConsentAndConditionalAccessHandler ConsentHandler
@inject IPhotoShareService PhotoShareService
@code {
    private List<string> Messages { get; } = [];
    
    
    private async Task GetPhotos()
    {
        try
        {
            var response = await PhotoShareService.GetPhotos(CancellationToken.None);
            Messages.Add($"GetPhotos: {response}");
            StateHasChanged();
        }
        catch (Exception e)
        {
            ConsentHandler.HandleException(e);
        }
    }
}
